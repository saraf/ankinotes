<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ page.title }} - {{ site.title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ '/assets/style.css' | relative_url }}">
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <h2>{{ site.title }}</h2>
      <input type="text" id="search-box" placeholder="Search..." onkeyup="searchNotes()">

      <div class="tag-group-list">
        {% assign tag_groups = site.data.tag_groups %}
        {% for group in tag_groups %}
          <button class="collapsible">{{ group[0] }}</button>
          <ul class="tag-list">
            {% for tag in group[1] %}
              <li><a href="{{ site.baseurl }}/tags/{{ tag | slugify }}/">{{ tag }}</a></li>
            {% endfor %}
          </ul>
        {% endfor %}
      </div>

      <hr>

      <ul id="post-list">
        {% assign sorted_posts = site.posts | sort: 'title' %}
        {% for post in sorted_posts %}
          <li><a href="{{ post.url | relative_url }}">{{ post.title }}</a></li>
        {% endfor %}
      </ul>
    </aside>
    <main class="content">
      {{ content }}
    </main>
  </div>

  <script>
    function searchNotes() {
      var input = document.getElementById('search-box').value.toLowerCase();
      var listItems = document.querySelectorAll('#post-list li');
      listItems.forEach(function(item) {
        var text = item.innerText.toLowerCase();
        item.style.display = text.includes(input) ? '' : 'none';
      });
    }

    // Collapsible tag groups
    const collapsibles = document.querySelectorAll(".collapsible");
    collapsibles.forEach(function(button) {
      button.addEventListener("click", function() {
        this.classList.toggle("active");
        const list = this.nextElementSibling;
        if (list.style.display === "block") {
          list.style.display = "none";
        } else {
          list.style.display = "block";
        }
      });
    });

    // Vim-style keyboard navigation
    document.addEventListener("keydown", function(e) {
      const links = Array.from(document.querySelectorAll("#post-list a"));
      let activeIndex = links.findIndex(link => link === document.activeElement);

      if (e.key === "j") {
        e.preventDefault();
        let next = activeIndex + 1;
        if (next < links.length) links[next].focus();
      } else if (e.key === "k") {
        e.preventDefault();
        let prev = activeIndex - 1;
        if (prev >= 0) links[prev].focus();
      }
    });
  </script>
</body>
</html>
